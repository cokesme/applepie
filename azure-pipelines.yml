parameters:
- name: rust
  displayName: Rust Version
  type: string
  # a version that builds with the old asm style
  # az pipelines run --name cokesme.applepie --parameters rust=nightly-2019-07-21
  default: 'nightly-2019-07-21'

trigger:
- master
- releases/*

pr:
- master
- releases/*

jobs:
- job: Windows
  pool:
    vmImage: 'windows-latest'
  variables:
      RUSTUP_TOOLCHAIN: ${{ parameters.rust }} 
  steps:
  - script: |
      mkdir "$(Build.ArtifactStagingDirectory)/bochservisor"
    displayName: Prep Build
  - script: |
      cargo build --manifest-path bochservisor/Cargo.toml --release
    displayName: Build 
  - task: CopyFiles@2
    inputs:
      sourceFolder: bochservisor 
      targetFolder: $(Build.ArtifactStagingDirectory)\bochservisor
  - publish: $(Build.ArtifactStagingDirectory)
    artifact: bochservisor-x64-win
